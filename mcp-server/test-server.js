#!/usr/bin/env node

/**
 * –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞ —Å Bridge –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
 * –°–∏–º—É–ª–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –æ—Ç ChatGPT –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞
 */

import { FrogFaceAPI } from './frogface-api.js';

async function testMCPServerWithBridge() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FrogFace MCP Server —Å Bridge –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π...\n');

  const api = new FrogFaceAPI();

  try {
    // –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Bridge
    console.log('üìù –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Bridge');
    const taskResult = await api.addTask({
      title: '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –ø—Ä–µ–º–∏–π –≤ Edison Bar',
      description: '–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–º–∏–π 3% –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞',
      priority: 'high',
      project: 'Edison',
      deadline: '2024-11-15',
      originalVoiceInput: '–°–µ—Ä–≥–µ–π, –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–º–∏–∏ –¥–ª—è Edison Bar'
    });
    console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ Bridge:', taskResult);
    console.log('');

    // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ Bridge  
    console.log('üìä –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–µ—Ä–µ–∑ Bridge');
    const stats = await api.getUserStats();
    console.log('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ Bridge:', stats);
    console.log('');

    // –¢–µ—Å—Ç 3: –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ - –ö–õ–Æ–ß–ï–í–ê–Ø –§–ò–ß–ê!
    console.log('üß† –¢–µ—Å—Ç 3: –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (MAIN FEATURE)');
    const voiceText = `
      –ü—Ä–∏–≤–µ—Ç! –°–µ–≥–æ–¥–Ω—è –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å Edison Bar - —Ç–∞–º –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–µ–º–∏—è–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞.
      –ü–ª–∞–Ω–∏—Ä—É—é —Ç–∞–∫–∂–µ –¥–æ–¥–µ–ª–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è Receptor, —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂ –∫ –∫–æ–Ω—Ü—É –Ω–µ–¥–µ–ª–∏.
      –ò —Ö–æ—á—É –ø–æ—Ç–æ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ FrogFace RPG - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏, –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.
      –ï—â—ë –Ω—É–∂–Ω–æ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–∞–º–µ, –æ–Ω–∞ –≤–æ–ª–Ω—É–µ—Ç—Å—è. –ò –∫—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–∞ —É–∂–∏–Ω.
      –ê, –∏ —Å—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø–∏—Å—å–º–∞ –æ—Ç –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ –ø–æ Receptor –ø—Ä–æ–µ–∫—Ç—É!
    `;
    
    const analysis = await api.analyzeVoiceStream(voiceText, { 
      user: 'Sergey',
      time: 'morning',
      biorhythm: 'peak_productivity',
      projects: ['Edison', 'Receptor', 'FrogFace'] 
    });
    console.log('‚úÖ –ê–Ω–∞–ª–∏–∑ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞:', analysis);
    console.log('');

    // –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ Bridge
    console.log('üéØ –¢–µ—Å—Ç 4: –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Bridge');
    const tasks = await api.getActiveTasks();
    console.log('‚úÖ –ó–∞–¥–∞—á–∏ –∏–∑ Bridge:', tasks);
    console.log('');

    // –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ Bridge
    console.log('üîç –¢–µ—Å—Ç 5: –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Bridge');
    const testPhrases = [
      '–ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é –≤ Edison Bar –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é',
      '–î–æ–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å API –¥–ª—è Receptor B2B –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã', 
      '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã –≤ FrogFace RPG —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
      '–ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ –∂–µ–Ω–µ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –∏ —Å—Ö–æ–¥–∏—Ç—å –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª'
    ];

    testPhrases.forEach(phrase => {
      const project = api.bridge.detectProject(phrase);
      const priority = api.bridge.detectPriorityFromText(phrase);
      const time = api.bridge.estimateTaskTime(phrase);
      console.log(`üìù "${phrase}"`);
      console.log(`   ‚Üí –ü—Ä–æ–µ–∫—Ç: ${project} | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${priority} | –í—Ä–µ–º—è: ${time}`);
    });
    console.log('');

    // –¢–µ—Å—Ç 6: –°–∏–º—É–ª—è—Ü–∏—è ChatGPT voice workflow
    console.log('üé§ –¢–µ—Å—Ç 6: –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ ChatGPT voice ‚Üí MCP ‚Üí FrogFace –ø–∞–π–ø–ª–∞–π–Ω–∞');
    console.log('–°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –≤ ChatGPT –≥–æ–ª–æ—Å–æ–º...');
    
    const realVoiceExample = `
      –°–ª—É—à–∞–π, —É –º–µ–Ω—è —Å–µ–≥–æ–¥–Ω—è –ø–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å —É—Ç—Ä–∞ –¥–æ 11, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤—Ä–µ–º—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.
      –í–æ-–ø–µ—Ä–≤—ã—Ö, —Å—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å Edison - —Ç–∞–º –ø—Ä–æ–≤–∞–ª –≤ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è 18-21, –ø–µ—Ä—Å–æ–Ω–∞–ª –Ω–µ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.
      –•–æ—á—É –≤–Ω–µ–¥—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–º–∏–∏ 3% –∫–∞–∫ –º—ã –æ–±—Å—É–∂–¥–∞–ª–∏.
      –ü–æ—Ç–æ–º –ø–ª–∞–Ω–∏—Ä—É—é —á–∞—Å –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ Receptor - —É –Ω–∞—Å —Ç–∞–º 90% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏, –Ω—É–∂–Ω–æ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –ø—Ä–æ–¥–∞–∂.
      –ò –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤—Ä–µ–º—è, —Ö–æ—á—É –¥–æ–±–∞–≤–∏—Ç—å –≤ FrogFace –Ω–æ–≤—É—é —Ñ–∏—á—É - –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Notion API.
    `;
    
    const fullAnalysis = await api.analyzeVoiceStream(realVoiceExample);
    console.log('üéØ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ voice stream:', fullAnalysis);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á–∏ —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é
    if (fullAnalysis.extractedTasks) {
      console.log('\nü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é –∑–∞–¥–∞—á–∏ —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é (>80%)...');
      
      for (const task of fullAnalysis.extractedTasks) {
        if (task.confidence > 0.8) {
          const newTask = await api.addTask({
            title: task.title,
            priority: task.priority,
            originalVoiceInput: realVoiceExample,
            aiAnalysis: fullAnalysis,
            estimatedTime: task.estimatedTime
          });
          console.log(`‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–¥–∞—á–∞: "${newTask.task.text}" (${newTask.task.reward}‚ÇΩ)`);
        }
      }
    }

    console.log('\nüéâ –í–°–ï –¢–ï–°–¢–´ BRIDGE –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ü–†–û–ô–î–ï–ù–´!');
    console.log('üöÄ MCP Server –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ChatGPT voice!');
    console.log('üéØ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤ ChatGPT –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –∫–≤–µ—Å—Ç—ã –≤ FrogFace RPG!');

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Bridge:', error);
    console.error('Stack:', error.stack);
  }
}

// –ó–∞–ø—É—Å–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
testMCPServerWithBridge();